# Parallel xcorr programs for GMTSAR

## Introduction

In GMTSAR package, `xcorr` program is the main part of InSAR image registration. We apply parallel optimization to xcorr program of GMTSAR package. We provide two programs for different hardwares:

- `xcorr2` program is the multi-thread version
- `xcorr2_cl`  program is the GPU accelerated version


## Dependencies & Build

The code is written in C (`xcorr2`) and C++ (`xcorr2_cl`). To build the programs, C/C++ development tools must be installed. GNU toolchain is preferred, which includes `gcc` and `g++` compilers, and `make` tools.

`xcorr2` depends on following libraries:
- FFTW 3 (3.3.6 tested)
- Glib 2 (2.52.3 tested)

`xcorr2_cl` depends on following libraries:
- ArrayFire (3.5.0 tested)
- GPU drivers and GPGPU libraries (CUDA or OpenCL toolkits)

OS-specific building instructions are as follows.


### Ubuntu 16.04 LTS

Install GNU toolchain:

```bash
apt-get install build-essential
```

Install building dependencies of `xcorr2`:

```bash
apt-get install libglib2.0-dev libfftw3-dev
```

Install building dependencies of `xcorr2_cl`:

```bash
apt-get install libarrayfire-unified-dev libarrayfire-opencl3
```

Then, `cd` into source directory and run `make` to build the binaries.

```bash
make xcorr2     # build xcorr2 only
make xcorr2_cl  # build xcorr2_cl only
make            # build all binaries
```

Now you should get executable `xcorr2` and/or `xcorr2_cl` binaries.

To enable GPU acceleration, proper GPU drivers and OpenCL runtime libraries must be installed as well.

For recent NVIDIA cards with proprietary driver installed, install NVIDIA OpenCL driver (or full CUDA toolkit):

```bash
apt-get install nvidia-opencl-icd-XXX
# where XXX must be the same as the version of NVIDIA driver
```

For AMD/NVIDIA cards with open-source driver installed, install Mesa implementation of OpenCL:

```bash
apt-get install mesa-opencl-icd
```


## Usage

`xcorr2` and `xcorr2_cl` provide exact the same arguments as GMTSAR `xcorr` program.

For example, run it on ALOS SLC generated by GMTSAR:

```bash
xcorr2 IMG-HH-ALPSRP207600640-H1.0__A.PRM IMG-HH-ALPSRP227730640-H1.0__A.PRM -xsearch 64 -ysearch 64 -nx 32 -ny 64 -range_interp 2 -interp 16
```

`xcorr2` and `xcorr2_cl` is designed to be seamlessly integrated into GMTSAR package. To accelerate image registration in GMTSAR processing chain, you may:

- Simply replace original `xcorr` program with `xcorr2` or `xcorr2_cl`
- Or, edit related CSH scripts
